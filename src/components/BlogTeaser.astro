---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);
---
<section class="blog" id="blog">
  <div class="container">
    <div class="blog__head">
      <h2 class="section-title">Latest writing</h2>
      <p class="lead">Topics range from AI product development and developer tooling to the lessons learned outside the code editor.</p>
    </div>
    <div class="blog__grid">
      {posts.map((post) => (
        <article class="blog__card">
          <header>
            <p class="blog__meta">{post.data.publishDate.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })}</p>
            <h3>
              <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
            </h3>
          </header>
          <p>{post.data.description}</p>
          <ul class="blog__tags">
            {post.data.tags.map((tag) => (
              <li>{tag}</li>
            ))}
          </ul>
        </article>
      ))}
    </div>
    <div class="blog__cta">
      <a class="btn btn-secondary" href="/blog">View all posts</a>
    </div>
  </div>
</section>

<style>
  .blog {
    padding-block: clamp(3.5rem, 8vw, 5.5rem);
    background: color-mix(in srgb, var(--color-surface) 90%, transparent);
  }

  .blog__head {
    display: grid;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
  }

  .blog__grid {
    display: grid;
    gap: var(--space-5);
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .blog__card {
    padding: var(--space-5);
    border-radius: var(--radius-lg);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-sm);
    display: grid;
    gap: var(--space-3);
  }

  .blog__meta {
    margin: 0;
    color: var(--color-muted);
    font-size: var(--type-step-1);
  }

  .blog__card h3 {
    margin: 0;
    font-size: var(--type-step2);
  }

  .blog__card h3 a {
    color: var(--color-text);
  }

  .blog__card h3 a:hover,
  .blog__card h3 a:focus-visible {
    color: var(--color-primary);
  }

  .blog__tags {
    list-style: none;
    display: flex;
    gap: var(--space-2);
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
  }

  .blog__tags li {
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
    background: color-mix(in srgb, var(--color-secondary) 14%, transparent);
    color: var(--color-secondary);
    font-size: var(--type-step-1);
    font-weight: 600;
  }

  .blog__cta {
    margin-top: var(--space-6);
    display: flex;
    justify-content: center;
  }
</style>
